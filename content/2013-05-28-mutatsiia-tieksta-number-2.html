<html>
<head>
  <title>Мутация текста #2</title>
  <meta name="tags" content="experiment" />
  <meta name="date" content="2013-05-28 00:41" />
  <meta name="modified" content="2013-05-28 00:41" />
  <meta name="category" content="experiment" />
  <meta name="authors" content="Alykoff" />
  <meta name="summary" content="Цензура? Текст взят из 'Мастера и Маргариты'" />
  <meta name="rawcss" content="
    .text {
        text-align:justify;
        text-indent:20px;
        font-family:'Courier New', Courier, monospace;
    }
    .word {
        cursor:pointer;
        display:inline-block;
        padding:0 15px 0 0;
        margin:1px 1px;
        text-align:center;
        background:rgba(0,0,0,0.95);
        border:1px solid rgba(0,0,0,0);
    }
    .word:hover {
        background:white;
        border-radius:2px;
        border:1px solid #4e443e;
    }
    .word:selection {
        background:#E56521;
    }
  " />
</head>
<body>

<p class="text">
  Но никто не отозвался. Тут он взглянул на дверь в кабинет Берлиоза, бывшую рядом с передней, и тут, 
  как говорится, остолбенел. На ручке двери он разглядел огромнейшую сургучную печать на веревке. 
  "Здравствуйте! − рявкнул кто-то в голове у Степы. − Этого еще недоставало!" И тут Степины 
  мысли побежали уже по двойному рельсовому пути, но, как всегда бывает во время катастрофы, в одну сторону и 
  вообще черт знает куда. Головную Степину кашу трудно даже передать. Тут и чертовщина с 
  черным беретом, холодной водкой и невероятным контрактом, − а тут еще ко всему этому, не 
  угодно ли, и печать на двери! То есть кому хотите сказать, что Берлиоз что-то натворил, − не поверит, ей-ей, не поверит! Однако печать, вот она! Да-с…
</p>
<p class="text">
    И тут закопошились в мозгу у Степы какие-то неприятнейшие мыслишки о статье, которую, 
    как назло, недавно он всучил Михаилу Александровичу для напечатания в журнале. 
    И статья, между нами говоря, дурацкая! И никчемная, и деньги-то маленькие…
</p>

<script>
(function() {
  var paragrafsText = [];
  
  var elements = document.getElementsByClassName('text');

  // for cross-browsing
  var NODE_TEXT_NAME = 
    ('innerText' in document.getElementsByTagName('html')[0]) ? 
    "innerText" : 
    "textContent";
  
  var getCurrentTexts = function() {
    var texts = [];
    for (var i = 0, elementsLengh = elements.length; i < elementsLengh; i++) {
      var textEl = elements[i],
          text = textEl[NODE_TEXT_NAME].replace (/\s{2,}/g, ' ').trim();
      texts.push(text);
    }
    return texts;
  };
  
  var paragrafsText = getCurrentTexts();

  var buildWordIslands = function() {
    for (var i = 0, paragrafsLength = paragrafsText.length; i < paragrafsLength; i++) {
      var wordsInParagraf = paragrafsText[i].split(' '),
          totatHtml = '',
      	   wrappedWords = document.createElement('div');
          //SPACE = '&nbsp;';
      elements[i][NODE_TEXT_NAME] = '';
      for (var j = 0, wordsLength = wordsInParagraf.length; j < wordsLength; j++) {
      	var wordEl = document.createElement('span');
      	wordEl.className = 'word';
      	wordEl[NODE_TEXT_NAME] = wordsInParagraf[j];
      	wrappedWords.appendChild(wordEl);
      }
      elements[i].appendChild(wrappedWords);
    }
  };

  buildWordIslands();
}) ();
</script>

</body>
</html>